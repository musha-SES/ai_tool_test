# 日報分析ツール 仕様書

## 1. 概要

本ツールは、Google Apps Script (GAS) を用いて、日報の収集、AIによる分析、アラート通知、および結果のログ記録を自動化するシステムである。

## 2. 機能仕様

### 2.1. ユーザー・ルーム管理

-   **管理方法**: Googleスプレッドシートの`Chatwork設定`シートで、日報提出の対象となる社員（employee）と、その報告先となる管理者（manager）の情報をグループ単位で管理する。

### 2.2. 日報収集機能

-   **トリガー**: Googleスプレッドシートのカスタムメニューから手動実行、または設定された日次トリガーにより自動実行。
-   **処理内容**: `Chatwork設定`シートに登録されている`employee`ロールの全ユーザーに対し、日報提出を促す定型メッセージを送信する。

### 2.3. 日報分析・通知機能

-   **トリガー**: 手動実行、または日次トリガーにより自動実行。
-   **処理内容**:
    1.  `Chatwork設定`シートから全社員の情報を取得する。
    2.  各社員のChatworkダイレクトチャットからメッセージを取得し、BOTが送信した質問への返信であるかを識別する。
    3.  識別された日報メッセージ本文に対し、バリデーションを行う。
    4.  バリデーションに成功した場合、日報データをGemini APIに送信し、コンディションを5段階で評価する。
    5.  評価結果が`危険`または`少し悪い`の場合、担当マネージャーのChatworkにアラートを通知する。

### 2.4. ログ記録機能

-   **処理内容**: 分析された全ての日報データをAIの評価結果、担当マネージャー名と共に`日報ログ`シートに記録する。

### 2.5. 1on1ヒアリング項目生成機能

-   **トリガー**: Googleスプレッドシートのカスタムメニューから手動実行。
-   **処理内容**:
    1.  スクリプトプロパティから対象社員の氏名や関連情報を取得する。
    2.  `日報ログ`シートとGoogleドライブ上の`自己評価シート`から対象者の過去のデータを集約・要約する。
    3.  集約したデータを基に、**応答フォーマットを厳密に指定したプロンプト**を生成し、Gemini APIでヒアリング項目を生成させる。
    4.  Gemini APIからの応答を正規表現で解析し、**質問と根拠を正確に分離**する。
    5.  整形した結果を、対象社員の担当マネージャーのChatworkに通知する。根拠の全文が表示される。

## 3. 非機能仕様

-   **実行環境**: Google Apps Script
-   **外部連携API**: Google Gemini API, Chatwork API
-   **設定管理**: 
    -   APIキーなどの秘匿情報はスクリプトプロパティで管理する。
    -   シート名、キーワード、ヘッダー名などのアプリケーション設定は、コード冒頭の`CONFIG`オブジェクトで一元管理する。

---
最終更新日: 2025/07/11