# システム相関図

本ドキュメントは、「日報分析ツール」の主要な機能が、どのような順序で処理されていくかを図で示します。

## 1. 日報の収集・分析サイクル（日次自動実行）

```
+--------------------------+
|   時間トリガー (9:00 AM)   |
+------------+-------------+
             | (A) sendDailyReportQuestions 実行
             v
+--------------------------+
|   Google Apps Script     | --+ (B) Chatwork設定シート 読込 (Spreadsheet)
|    (nippou_tool.gs)      | --+ (C) 日報提出を依頼 (Chatwork API)
+--------------------------+   |
                               v
                             +--------------------------+
                             |      社員 (Employee)       |
                             |  (D) 日報を返信する        |
                             +------------+-------------+
                                          |
                                          v
+--------------------------+
|   時間トリガー (6:00 PM)   |
+------------+-------------+
             | (E) processChatworkReplies 実行
             v
+--------------------------+
|   Google Apps Script     | --+ (F) 日報の返信を取得 (Chatwork API)
|    (nippou_tool.gs)      | --+ (G) 日報を解析・検証
+------------+-------------+
             |
             +--> (H) 検証NG ----------------------> +---------------------------------+
             |                                      | Google Spreadsheet (BOT質問ログ)  |
             |                                      | (I) フォーマットエラーを記録        |
             |                                      +---------------------------------+
             |
             +--> (J) 検証OK ----------------------> +---------------------------------+
                                                    | Gemini API                      |
                                                    | (K) 日報内容を分析                |
                                                    +------------------+--------------+
                                                                       | (L) 分析結果
                                                                       v
+--------------------------+
|   Google Apps Script     | --+ (M) 日報と分析結果をログに記録 (Spreadsheet)
|    (nippou_tool.gs)      | --+ (N) AI評価が「悪い」場合、アラート通知 (Chatwork API)
+--------------------------+   |
                               v
                             +--------------------------+
                             |    マネージャー (Manager)    |
                             +--------------------------+
```

## 2. 1on1ヒアリング項目生成（手動実行）

```
+--------------------------+
|    マネージャー (Manager)    |
| (スプレッドシートのメニュー操作) |
+------------+-------------+
             | (A) generate1on1Topics 実行
             v
+--------------------------+
|   Google Apps Script     | --+ (B) 日報ログを取得 (Spreadsheet)
|    (nippou_tool.gs)      | --+ (C) 自己評価シートを取得 (Google Drive)
+------------+-------------+
             |
             | (D) 日報と自己評価を要約
             v
+--------------------------+
|        Gemini API        |
| (E) 要約を基にヒアリング項目生成 |
+------------+-------------+
             | (F) 生成された項目
             v
+--------------------------+
|   Google Apps Script     | --+ (G) 項目を整形して通知 (Chatwork API)
|    (nippou_tool.gs)      |   |
+--------------------------+   v
                             +--------------------------+
                             |    マネージャー (Manager)    |
                             +--------------------------+
```

## 3. 週次レポート生成（週次自動実行）

```
+------------------------------------+
|   時間トリガー (毎週月曜 10:00 AM)   |
+------------------+-----------------+
                   | (A) generateWeeklyReports 実行
                   v
+------------------------------------+
|   Google Apps Script               | --+ (B) Chatwork設定シート 読込 (Spreadsheet)
|    (nippou_tool.gs)                | --+ (C) 日報ログシート 読込 (Spreadsheet)
+------------------+-----------------+
                   |
                   | (D) マネージャー毎に処理を分岐
                   |
+------------------+----------------------------------------------------+
|                                                                     |
| (E) weeklyReportMode === 'individual'                               | (F) weeklyReportMode === 'team'
|                                                                     |
v                                                                     v
+------------------------------------+                                    +------------------------------------+
| Google Apps Script                 | --+ (G) 各メンバーのレポートを集約し、整形して通知 (Chatwork API) | Google Apps Script                 | --+ (H) 過去1週間分の日報を集計
| (個人別レポート)                   |   |                                    | (チームサマリー)                   |   |
+------------------+-----------------+   |                                    +------------------+-----------------+
                   |                   v                                                      v
                   |                 +--------------------------+                                    +------------------------------------+
                   |                 |    マネージャー (Manager)    |                                    | Gemini API                         |
                   |                 +--------------------------+                                    | (I) チームコンディションサマリー生成 |
                   |                                                                              +------------------+-----------------+
                   |                                                                                                 | (J) 生成されたサマリー
                   |                                                                                                 v
                   |                                                                              +------------------------------------+
                   |                                                                              | Google Apps Script                 | --+ (K) 整形して通知 (Chatwork API)
                   |                                                                              | (チームサマリー通知)               |   |
                   |                                                                              +------------------+-----------------+
                   |                                                                                                 |                   v
                   |                                                                                                 |                 +--------------------------+
                   +-------------------------------------------------------------------------------------------------+-----------------> |    マネージャー (Manager)    |
                                                                                                                                   +--------------------------+
```