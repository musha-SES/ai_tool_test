# 日報要約AI & Chatwork連携ツール 取扱説明書

## 1. このツールについて

このツールは、Google Apps Script (GAS) を利用して、日報業務と1on1面談の準備を効率化・自動化します。

-   **日報の自動収集**: ChatworkのBotが、毎日決まった時刻に各メンバーへ日報提出を促します。
-   **AIによるコンディション分析**: 提出された日報の内容をGemini APIが分析し、メンバーのコンディションを「非常に良い」から「危険」までの5段階で評価します。
-   **自動アラート通知**: AIがメンバーの不調（`危険`または`少し悪い`）を検知した場合、即座に担当マネージャーのChatworkにアラートを送信し、早期対応を促します。
-   **活動ログの自動蓄積**: 分析したすべての日報データとAIの評価結果は、Googleスプレッドシートに自動で記録・蓄積され、後から分析や振り返りに活用できます。
-   **1on1面談のトピック自動生成**: 特定メンバーの過去の日報ログと自己評価シートのデータをAIが横断的に分析し、マネージャーが次に話すべき具体的なヒアリング項目を提案します。

## 2. 導入と初期設定

### STEP 1: Chatwork APIキーの準備

Chatwork APIを利用するために、APIキーを発行する必要があります。
管理者権限を持つアカウントでChatworkにログインし、[API設定](https://www.chatwork.com/service/packages/chatwork/subpackages/api/token.php)からAPIトークンを発行してください。発行したAPIキーは安全な場所に保管してください。

### STEP 2: スプレッドシートの準備とコードの配置

1.  **新規スプレッドシート作成**: Googleドライブで新しいスプレッドシートを作成します。このファイルがツールの管理画面になります。
2.  **GASエディタを開く**: メニューから `拡張機能` > `Apps Script` を選択します。
3.  **コードの貼り付け**: `src/Main.gs` の中身をすべてコピーし、GASエディタに貼り付けて保存します。（元からある`function myFunction() {}`などのコードは消してください）

### STEP 3: シートの作成とヘッダー設定

スプレッドシートに、以下の3つのシートを正確な名前で作成し、各1行目に指定のヘッダーを入力してください。

1.  **`Chatwork設定`シート**: 誰に日報を依頼し、誰がその報告を受けるかを定義します。
    | A列 | B列 | C列 | D列 | E列 |
    | :--- | :--- | :--- | :--- | :--- |
    | グループ名 | 氏名 | ルームID | 役割 | 週次レポートモード |
    -   **グループ名**: マネージャーと社員を紐付けるための名前です（例: `営業チーム`）。
    -   **氏名**: ユーザーのフルネームを記入します。
    -   **ルームID**: ChatworkのルームIDを記入します。ダイレクトメッセージのルームIDは、URLの`#!rid`以降の数字です。
    -   **役割**: `manager` または `employee` のいずれかを小文字で入力します。
    -   **週次レポートモード**: `manager`の行に設定します。`team`と入力するとチーム全体の要約レポート、`individual`と入力するとメンバーごとの日報をまとめたレポートが通知されます。**空欄の場合は`individual`として動作します。**

2.  **`日報ログ`シート**: 提出された全ての日報データが蓄積されます。
    | A列 | B列 | C列 | D列 | E列 | F列 | G列 | H列 | I列 |
    | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
    | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること | AI評価状態 | AI評価理由 |

3.  **`BOT質問ログ`シート**: Botが送信した質問の履歴と、それに対する返信状況を管理します。
    | A列 | B列 | C列 | D列 | E列 |
    | :--- | :--- | :--- | :--- | :--- |
    | roomId | messageId | timestamp | status | errorDetail |

### STEP 4: スクリプトプロパティの設定

GASエディタの左メニューにある歯車アイコン（`プロジェクトの設定`）をクリックし、「スクリプト プロパティ」のセクションで `＋ スクリプト プロパティを追加` をクリックし、以下の情報を追加します。

| プロパティ名 | 値の例 | 説明 |
| :--- | :--- | :--- |
| `CHATWORK_API_KEY` | `a1b2c3d4e5f6...` | **【必須】** STEP 1で取得したChatwork APIキー。 |
| `GEMINI_API_KEY` | `AIzaSy...` | **【必須】** あなたのGemini APIキー。 |
| `TARGET_EMPLOYEE_NAME_FOR_1ON1` | `山田 太郎` | (任意) 1on1ヒアリング項目を生成したい社員の氏名。`Chatwork設定`シートの氏名と完全に一致させてください。 |
| `SELF_EVALUATION_FOLDER_ID` | `1a2b3c...` | (任意) 1on1機能で利用する自己評価シートが保存されているGoogleドライブのフォルダID。 |
| `SELF_EVALUATION_INPUT_SHEET_NAME` | `評価シート` | (任意) 自己評価シート（スプレッドシート）内の、データが入力されているシート名。 |

## 3. ツールの使い方

### 3.1. 定期実行トリガーの設定

1.  スプレッドシートを開き、カスタムメニューの `日報AIツール` > `定期実行トリガーを設定` をクリックします。
2.  初回実行時、Googleからスクリプトの実行に関する承認を求められます。内容を確認し、許可してください。
3.  これにより、毎日決まった時刻（デフォルト: 質問9時、収集18時）に日報の送受信が自動的に行われます。

### 3.2. 日報の提出フロー（社員向け）

1.  Botから「本日の日報を...」というメッセージが届きます。
2.  そのメッセージに**返信**する形で、以下のフォーマットに従って日報を記述し、送信します。

    ```
    #日報
    業務内容：今日のタスクAとBを完了しました。
    気分：良い
    困っていること：特になし
    ```

### 3.3. 1on1ヒアリング項目の生成（マネージャー向け）

1.  **事前準備**:
    -   スクリプトプロパティ `TARGET_EMPLOYEE_NAME_FOR_1ON1` に、対象社員の氏名を設定します。
    -   必要に応じて、`SELF_EVALUATION_FOLDER_ID` と `SELF_EVALUATION_INPUT_SHEET_NAME` も設定します。
    -   対象社員の自己評価シートが、指定したGoogleドライブのフォルダに存在することを確認します。
2.  **実行**:
    -   スプレッドシートのメニュー `日報AIツール` > `1on1ヒアリング項目生成` をクリックします。
3.  **結果の確認**:
    -   処理が完了すると、あなたのChatwork（`Chatwork設定`シートで`manager`として設定されているユーザー）に、AIが提案したヒアリング項目が通知されます。

### 3.4. 週次レポートの生成（マネージャー向け）

この機能は、チーム全体の日報ログからコンディションの傾向を分析し、週次レポートを生成してマネージャーに通知します。レポート形式は`Chatwork設定`シートの`週次レポートモード`列で制御できます。

1.  **手動実行**:
    -   スプレッドシートのメニュー `日報AIツール` > `週次レポート生成` をクリックします。
    -   実行後、`Chatwork設定`シートで`manager`として設定されているユーザーのChatworkに、設定に応じた週次レポートが通知されます。
2.  **自動実行**:
    -   `日報AIツール` > `定期実行トリガーを設定` を実行すると、毎週月曜日の午前10時（デフォルト設定）に自動でレポートが生成され、マネージャーに通知されます。

## 4. トラブルシューティング

-   **Q. 日報の質問が届きません。**
    -   A1: `定期実行トリガーを設定`が実行されているか確認してください。
    -   A2: `Chatwork設定`シートのあなたの情報（ルームID、役割など）が正しいか確認してください。
    -   A3: `BOT質問ログ`シートに、あなたの前日分の日報が「未返信」や「エラー」のまま残っていませんか？その場合、当日の質問はスキップされます。
-   **Q. 日報を提出したのに「フォーマット不正」とログに残ってしまいます。**
    -   A1: Botのメッセージに**返信**していますか？新規メッセージで送ると認識されません。
    -   A2: `#日報` `業務内容：` `気分：` `困っていること：` のキーワードが正確に含まれていますか？（コロンは全角でも半角でも可）
    -   A3: 「気分」は `良い` `普通` `少し悪い` `悪い` のいずれかになっていますか？
-   **Q. 「1on1ヒアリング項目生成」でエラーが出ます。**
    -   A1: スクリプトプロパティの各種キー（対象者名、フォルダIDなど）が正しく設定されているか確認してください。
    -   A2: `日報ログ`シートに対象者のデータが十分に存在するか確認してください。
    -   A3: 指定したフォルダに、対象者の名前を含む自己評価シートが存在するか確認してください。

---
最終更新日: 2025/07/23