# 日報要約AI & Chatwork連携ツール 取扱説明書

## 1. このツールについて

このツールは、Google Apps Script (GAS) を利用して、以下の業務を自動化します。

-   **日報の収集**: ChatworkのBOT（あなたの分身）が、各メンバーに日報の提出を依頼します。
-   **AIによる分析**: 提出された日報の内容をGemini APIが分析し、メンバーのコンディションを「非常に良い」「良い」「普通」「少し悪い」「危険」の5段階で評価します。
-   **アラート通知**: AIが「少し悪い」または「危険」と判断した場合、マネージャーのChatwork（マイチャット）にアラート通知を送信します。
-   **ログの蓄積**: 分析したすべての日報データとAIの評価結果を、Googleスプレッドシートに自動で記録・蓄積します。
-   **1on1トピック生成**: 特定メンバーの過去の日報ログをAIが分析し、1on1面談で話すべきヒアリング項目を提案します。

## 2. 導入と初期設定

### STEP 1: Googleスプレッドシートの準備

1.  **新規スプレッドシート作成**: Googleドライブで新しいスプレッドシートを作成します。このファイルがツールの土台になります。
2.  **GASエディタを開く**: メニューから `拡張機能` > `Apps Script` を選択します。
3.  **コードの貼り付け**: `nippou_tool.txt` の中身をすべてコピーし、GASエディタに貼り付けて保存します。（元からあるコードは消してください）
4.  **ログ用シートの作成**:
    -   スプレッドシートに戻り、左下の `+` ボタンで新しいシートを追加します。
    -   シート名を `日報ログ` に変更します。
    -   `日報ログ` シートの1行目に、以下のヘッダーをA列から順番に入力します。

| A列 | B列 | C列 | D列 | E列 | F列 | G列 | H列 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| タイムスタンプ | 氏名 | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること | AI評価状態 | AI評価理由 |

5.  **BOT質問ログ用シートの作成**:
    -   スプレッドシートに戻り、左下の `+` ボタンで新しいシートを追加します。
    -   シート名を `BOT質問ログ` に変更します。
    -   `BOT質問ログ` シートの1行目に、以下のヘッダーをA列から順番に入力します。

| A列 | B列 | C列 | D列 | E列 |
| :--- | :--- | :--- | :--- | :--- |
| ルームID | 質問メッセージID | 送信日時 | ステータス | エラー詳細 |

### STEP 2: 各種APIキーとIDの設定

1.  **スクリプトプロパティを開く**: GASエディタの左メニューにある歯車アイコン（`プロジェクトの設定`）をクリックし、「スクリプト プロパティ」のセクションに進みます。
2.  **プロパティの追加**: `＋ スクリプト プロパティを追加` をクリックし、以下の情報を追加します。値にクォート（`'` や `"`）は不要です。

| プロパティ名 | 値の例 | 説明 |
| :--- | :--- | :--- |
| `CHATWORK_API_KEY` | `your_chatwork_api_token` | あなたのChatwork APIトークン。 |
| `CHATWORK_ROOM_IDS` | `{"manager":"12345", "山田太郎":"67890"}` | マネージャーと部下のルームID。JSON形式で記述。 |
| `GEMINI_API_KEY` | `AIzaSy...` | あなたのGemini APIキー。 |
| `TARGET_EMPLOYEE_NAME_FOR_1ON1` | `山田太郎` | (任意) 1on1ヒアリング項目を生成したい社員の氏名。 |
| `DAILY_QUESTION_TIME_HOUR` | `9` | (任意) 日報の質問を送信する時刻（時）。デフォルトは9時。 |
| `DAILY_QUESTION_TIME_MINUTE` | `0` | (任意) 日報の質問を送信する時刻（分）。デフォルトは0分。 |
| `DAILY_REPLY_COLLECT_TIME_HOUR` | `18` | (任意) 日報の返信を収集・分析する時刻（時）。デフォルトは18時。 |
| `DAILY_REPLY_COLLECT_TIME_MINUTE`| `0` | (任意) 日報の返信を収集・分析する時刻（分）。デフォルトは0分。 |

#### APIキーとIDの取得方法

-   **Chatwork APIトークン**:
    1.  Chatwork右上のユーザーアイコン > `API設定` を開きます。
    2.  パスワードを入力し、「API Token」を発行します。
-   **Chatwork ルームID**:
    -   チャットを開いたときのURL `https://www.chatwork.com/#!rid` の後に続く数字がルームIDです。
    -   `manager` には、**あなた自身の「マイチャット」のルームID**を設定してください。アラート通知や1on1トピックがここに届きます。
    -   メンバーのIDは、**あなたとメンバーの「1対1のダイレクトチャット」のルームID**を設定してください。

## 3. ツールの使い方

### STEP 1: 定期実行トリガーを設定する

本ツールは、毎日決まった時間に日報の依頼と収集を自動で行うことができます。

1.  スプレッドシートを開き、メニューの `日報AIツール` > `定期実行トリガーを設定` をクリックします。
    -   初回実行時は、Googleから承認を求められるので、許可してください。
2.  実行すると、スクリプトプロパティで設定した時刻（未設定の場合はデフォルト時刻）でトリガーが設定され、完了アラートが表示されます。
    -   **重複質問防止**: `BOT質問ログ` シートに未処理（`未返信`、`返信済み_フォーマット不正`、`エラー発生`）の質問がある場合、そのメンバーへの質問はスキップされます。
    -   **ログの自動クリーンアップ**: 毎週月曜日の深夜に、古いログ（`返信済み_処理成功`、7日以上前の`未返信`、7日以上前の`エラー発生`）が自動で削除されます。

**※手動で実行したい場合**
-   `日報AIツール` > `日報質問送信（Chatwork）`
-   `日報AIツール` > `Chatwork日報取得・分析`

から、いつでも手動で実行することも可能です。

### STEP 2: メンバーへのお願い（日報の返信ルール）

このツールが正しく動作するために、日報を提出するメンバーには、BOTからの質問メッセージに対して**Chatworkの「返信」機能を使って返信する**よう周知してください。

**【重要】** 返信メッセージの本文には、`#日報` ハッシュタグを含め、`業務内容：`、`気分：`、`困っていること：` のキーワードとコロン（`：`）は、AIが内容を正しく理解するために必須です。

**良い返信例:**
```
[rp aid=1234567 to=1234567-8901234567]
[To:1234567] 山田太郎さん
おはようございます！
本日の日報を以下のフォーマットでご返信ください。

#日報
業務内容：
気分：(良い/普通/悪い)
困っていること：
[/rp]
#日報
業務内容：〇〇のタスクを完了しました。
気分：普通
困っていること：特にありません。
```

### STEP 3: 1on1ヒアリング項目の生成（任意）

マネージャーは、特定のメンバーとの1on1面談に向けたヒアリング項目をAIに提案させることができます。

1.  **対象者の設定**: GASエディタの「プロジェクトの設定」>「スクリプト プロパティ」で、`TARGET_EMPLOYEE_NAME_FOR_1ON1` に対象者の氏名を設定します。
2.  **実行**: スプレッドシートに戻り、メニューの `日報AIツール` > `1on1ヒアリング項目生成` をクリックします。
3.  **結果の確認**: 実行後、AIが生成したヒアリング項目の提案が、マネージャーのChatwork（マイチャット）に通知されます。

---
以上で説明を終わります。ご不明な点があれば、開発者にお問い合わせください。